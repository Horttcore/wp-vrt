(()=>{"use strict";const e=window.wp.element,t=window.wp.components,a=window.wpVrtAdminData||{},l=()=>(0,e.createElement)("div",{className:"wp-vrt-header"},(0,e.createElement)("div",{className:"wp-vrt-header-main"},(0,e.createElement)("h1",{className:"wp-vrt-title"},"WP VRT"),(0,e.createElement)("p",{className:"wp-vrt-subtitle"},"Virtual pages for visual regression testing.")),(0,e.createElement)("div",{className:"wp-vrt-actions"},(0,e.createElement)(t.Button,{href:a.discoveryUrl,target:"_blank",rel:"noopener",variant:"secondary"},"Discovery endpoint"))),s=({title:a,description:l,items:s,search:r,onToggleItem:n})=>{const i=s.filter(e=>!r||(e.label+" "+e.url).toLowerCase().includes(r.toLowerCase())).sort((e,t)=>{const a=(e.label||"").toLowerCase(),l=(t.label||"").toLowerCase();return a<l?-1:a>l?1:!!e.isDisabled==!!t.isDisabled?0:e.isDisabled?1:-1});return r&&0===i.length?(0,e.createElement)("div",{className:"wp-vrt-section"},(0,e.createElement)("div",{className:"wp-vrt-section-header"},(0,e.createElement)("div",null,(0,e.createElement)("h2",{className:"components-heading"},a),(0,e.createElement)("p",{className:"wp-vrt-section-desc"},l)),(0,e.createElement)("span",{className:"wp-vrt-pill"},"0")),(0,e.createElement)("p",{className:"wp-vrt-empty"},"No items found.")):(0,e.createElement)("div",{className:"wp-vrt-section"},(0,e.createElement)("div",{className:"wp-vrt-section-header"},(0,e.createElement)("div",null,(0,e.createElement)("h2",{className:"components-heading"},a),(0,e.createElement)("p",{className:"wp-vrt-section-desc"},l)),(0,e.createElement)("span",{className:"wp-vrt-pill"},String(i.length))),0===i.length?(0,e.createElement)("p",{className:"wp-vrt-empty"},"No items found."):(0,e.createElement)("div",{className:"wp-vrt-list wp-vrt-list-grid"},i.map(a=>(0,e.createElement)("div",{key:a.url,className:"wp-vrt-row"+(a.isDisabled?" is-disabled":"")},(0,e.createElement)("div",{className:"wp-vrt-row-main"},(0,e.createElement)("span",{className:"wp-vrt-row-label"},a.toggleUrl?(0,e.createElement)("div",{className:"wp-vrt-toggle"},(0,e.createElement)(t.ToggleControl,{checked:!a.isDisabled,label:"",onChange:()=>n?.(a)})):null,(0,e.createElement)("a",{className:"wp-vrt-row-link",href:a.url,target:"_blank",rel:"noopener"},a.label),a.isVrt?(0,e.createElement)("span",{className:"wp-vrt-tag wp-vrt-tag-vrt"},"VRT"):null,a.isDynamic?(0,e.createElement)("span",{className:"wp-vrt-tag"},"Dynamic"):null))))))},r=({groups:a,onToggleItem:l,onToggleGroup:s,search:r})=>a&&0!==a.length?(0,e.createElement)("div",{className:"wp-vrt-groups"},a.map(a=>{const n=(a.items||[]).filter(e=>!r||(e.label+" "+e.url).toLowerCase().includes(r.toLowerCase()));return 0===n.length?null:(0,e.createElement)("div",{className:"wp-vrt-group",key:a.title},(0,e.createElement)("div",{className:"wp-vrt-group-header"},(0,e.createElement)("div",null,(0,e.createElement)("h3",{className:"components-heading"},a.title),a.description?(0,e.createElement)("p",{className:"wp-vrt-section-desc"},a.description):null),(0,e.createElement)("div",{className:"wp-vrt-group-meta"},(0,e.createElement)("span",{className:"wp-vrt-pill"},String(n.length)),(0,e.createElement)("div",{className:"wp-vrt-group-actions"},(0,e.createElement)(t.ToggleControl,{className:"wp-vrt-bulk-toggle",checked:!n.every(e=>e.isDisabled),label:"Enabled",onChange:e=>s?.({...a,items:n},!e)})))),(0,e.createElement)("div",{className:"wp-vrt-list wp-vrt-list-grid"},n.sort((e,t)=>{const a=(e.label||"").toLowerCase(),l=(t.label||"").toLowerCase();return a<l?-1:a>l?1:!!e.isDisabled==!!t.isDisabled?0:e.isDisabled?1:-1}).map(a=>(0,e.createElement)("div",{key:a.url,className:"wp-vrt-row"+(a.isDisabled?" is-disabled":"")},(0,e.createElement)("div",{className:"wp-vrt-row-main"},(0,e.createElement)("span",{className:"wp-vrt-row-label"},a.toggleUrl?(0,e.createElement)("div",{className:"wp-vrt-toggle"},(0,e.createElement)(t.ToggleControl,{checked:!a.isDisabled,label:"",onChange:()=>l?.(a)})):null,(0,e.createElement)("a",{className:"wp-vrt-row-link",href:a.url,target:"_blank",rel:"noopener"},a.label)))))))}).filter(Boolean)):null,n=({section:a,onToggleItem:l,onToggleAll:n,onToggleGroup:i})=>{const[o,c]=(0,e.useState)(""),[m,p]=(0,e.useState)("all");return(0,e.createElement)("div",{className:"wp-vrt-tab-panel"+(a.type?` wp-vrt-${a.type}`:"")},(0,e.createElement)("div",{className:"wp-vrt-toolbar"},(0,e.createElement)(t.SearchControl,{className:"wp-vrt-search",placeholder:`Search ${a.title.toLowerCase()}â€¦`,value:o,onChange:e=>c(e)}),a.categories&&a.categories.length>0?(0,e.createElement)("div",{className:"wp-vrt-filter"},(0,e.createElement)("button",{type:"button",className:"wp-vrt-chip"+("all"===(m||"all")?" is-active":""),onClick:()=>p("all")},"All"),a.categories.map(t=>(0,e.createElement)("button",{key:t.slug,type:"button",className:"wp-vrt-chip"+(m===t.slug?" is-active":""),onClick:()=>p(t.slug)},t.title))):null,(0,e.createElement)("div",{className:"wp-vrt-bulk"},a.bulkType||a.type?(0,e.createElement)(t.ToggleControl,{className:"wp-vrt-bulk-toggle",checked:(a.items||[]).some(e=>!e.isDisabled),label:"Enabled",onChange:e=>n?.(a,!e)}):null)),a.categories&&a.categories.length>0?(0,e.createElement)("div",{className:"wp-vrt-grid"},(0,e.createElement)(r,{groups:m&&"all"!==m?a.categories.filter(e=>e.slug===m):a.categories,onToggleItem:l,onToggleGroup:i,search:o})):"Blocks"===a.title&&a.groups?(0,e.createElement)("div",{className:"wp-vrt-grid"},(0,e.createElement)(r,{groups:a.groups,onToggleItem:l,onToggleGroup:i,search:o})):(0,e.createElement)("div",{className:"wp-vrt-grid"},(0,e.createElement)(s,{title:a.title,description:a.description,items:a.items||[],search:o,onToggleItem:l})))},i=document.getElementById("wp-vrt-app");i&&(0,e.render)((0,e.createElement)(()=>{if(!a.baseUrl)return(0,e.createElement)(t.Notice,{status:"warning",isDismissible:!1},"WP VRT data not available.");const s=(a.sections||[]).map(t=>{const l=a.stats?.[t.title]??"",s=""!==l?(0,e.createElement)("span",{className:"wp-vrt-tab-label"},t.title,(0,e.createElement)("span",{className:"wp-vrt-tab-count"},String(l))):t.title;return{name:t.title,title:s,className:"wp-vrt-tab"}}),[r,i]=(0,e.useState)(()=>a.sections||[]),o=async e=>{const t=r.findIndex(t=>t.items?.some(t=>t.url===e.url)),l=r[t]?.type,s=e.toggleType||l,n=e.toggleUrl?new URL(e.toggleUrl,window.location.href).searchParams.get("id"):null;if(!s||!n)return;const o=!e.isDisabled;await(async({type:e,id:t,disable:l})=>{const s=new FormData;if(s.append("action","wp_vrt_toggle_item"),s.append("_wpnonce",a.toggleNonce||""),s.append("type",e),s.append("id",t),s.append("disable",l?"1":"0"),!(await fetch(a.ajaxUrl||"",{method:"POST",credentials:"same-origin",body:s})).ok)throw new Error("Failed to toggle item")})({type:s,id:n,disable:o});const c=r.map(t=>{const a=(t.items||[]).map(t=>t.url===e.url?{...t,isDisabled:o}:t),l=(t.groups||[]).map(t=>({...t,items:(t.items||[]).map(t=>t.url===e.url?{...t,isDisabled:o}:t)})),s=(t.categories||[]).map(t=>({...t,items:(t.items||[]).map(t=>t.url===e.url?{...t,isDisabled:o}:t)}));return{...t,items:a,groups:l,categories:s}});i(c)},c=async(e,t,l="")=>{const s=l||e.bulkType||e.type;if(!s)return;await(async({type:e,disable:t})=>{const l=new FormData;if(l.append("action","wp_vrt_toggle_all"),l.append("_wpnonce",a.toggleAllNonce||""),l.append("type",e),l.append("disable",t?"1":"0"),!(await fetch(a.ajaxUrl||"",{method:"POST",credentials:"same-origin",body:l})).ok)throw new Error("Failed to toggle all")})({type:s,disable:t});const n=r.map(a=>{if(a.title!==e.title)return a;const s=e=>"pattern-vrt"!==l||e.isVrt,r=(a.items||[]).map(e=>s(e)?{...e,isDisabled:t}:e),n=(a.groups||[]).map(e=>({...e,items:(e.items||[]).map(e=>s(e)?{...e,isDisabled:t}:e)})),i=(a.categories||[]).map(e=>({...e,items:(e.items||[]).map(e=>s(e)?{...e,isDisabled:t}:e)}));return{...a,items:r,groups:n,categories:i}});i(n)},m=async(e,t)=>{const l=(e.items||[]).map(e=>e.toggleUrl?new URL(e.toggleUrl,window.location.href).searchParams.get("id"):null).filter(Boolean);if(0===l.length)return;await(async({type:e,ids:t,disable:l})=>{const s=new FormData;if(s.append("action","wp_vrt_toggle_group"),s.append("_wpnonce",a.toggleAllNonce||""),s.append("type",e),s.append("disable",l?"1":"0"),t.forEach(e=>s.append("ids[]",e)),!(await fetch(a.ajaxUrl||"",{method:"POST",credentials:"same-origin",body:s})).ok)throw new Error("Failed to toggle group")})({type:e.type||"block",ids:l,disable:t});const s=r.map(e=>{const a=(e.items||[]).map(e=>{const a=e.toggleUrl?new URL(e.toggleUrl,window.location.href).searchParams.get("id"):null;return a&&l.includes(a)?{...e,isDisabled:t}:e}),s=(e.groups||[]).map(e=>({...e,items:(e.items||[]).map(e=>{const a=e.toggleUrl?new URL(e.toggleUrl,window.location.href).searchParams.get("id"):null;return a&&l.includes(a)?{...e,isDisabled:t}:e})})),r=(e.categories||[]).map(e=>({...e,items:(e.items||[]).map(e=>{const a=e.toggleUrl?new URL(e.toggleUrl,window.location.href).searchParams.get("id"):null;return a&&l.includes(a)?{...e,isDisabled:t}:e})}));return{...e,items:a,groups:s,categories:r}});i(s)};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(l),(0,e.createElement)(t.TabPanel,{className:"wp-vrt-tabs",tabs:s},t=>{const a=r.find(e=>e.title===t.name);return a?(0,e.createElement)(n,{section:a,onToggleItem:o,onToggleAll:c,onToggleGroup:m}):null}))}),i)})();