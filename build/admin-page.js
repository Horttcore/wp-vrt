(()=>{"use strict";const e=window.wp.element,t=window.wp.components;var a=Object.prototype.hasOwnProperty;function r(e,t,a){for(a of e.keys())if(l(a,t))return a}function l(e,t){var n,s,i;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((s=e.length)===t.length)for(;s--&&l(e[s],t[s]););return-1===s}if(n===Set){if(e.size!==t.size)return!1;for(s of e){if((i=s)&&"object"==typeof i&&!(i=r(t,i)))return!1;if(!t.has(i))return!1}return!0}if(n===Map){if(e.size!==t.size)return!1;for(s of e){if((i=s[0])&&"object"==typeof i&&!(i=r(t,i)))return!1;if(!l(s[1],t.get(i)))return!1}return!0}if(n===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(n===DataView){if((s=e.byteLength)===t.byteLength)for(;s--&&e.getInt8(s)===t.getInt8(s););return-1===s}if(ArrayBuffer.isView(e)){if((s=e.byteLength)===t.byteLength)for(;s--&&e[s]===t[s];);return-1===s}if(!n||"object"==typeof e){for(n in s=0,e){if(a.call(e,n)&&++s&&!a.call(t,n))return!1;if(!(n in t)||!l(e[n],t[n]))return!1}return Object.keys(t).length===s}}return e!=e&&t!=t}const n=window.wp.data,s=window.wp.preferences,i=window.wpVrtAdminData||{},o=()=>(0,e.createElement)("div",{className:"wp-vrt-header"},(0,e.createElement)("div",null,(0,e.createElement)("h1",{className:"wp-vrt-title"},"WP VRT"),(0,e.createElement)("p",{className:"wp-vrt-subtitle"},"Virtual pages for visual regression testing.")),(0,e.createElement)("div",{className:"wp-vrt-actions"},(0,e.createElement)(t.Button,{href:i.showDisabledUrl,variant:"secondary"},i.showDisabled?"Hide disabled":"Show disabled"),(0,e.createElement)(t.Button,{href:i.discoveryUrl,target:"_blank",rel:"noopener",variant:"secondary"},"Discovery endpoint"),(0,e.createElement)(t.Button,{href:i.baseUrl,target:"_blank",rel:"noopener",variant:"primary"},"Open base URL"))),c=()=>(0,e.createElement)("div",{className:"wp-vrt-stats"},Object.entries(i.stats||{}).map(([a,r])=>(0,e.createElement)(t.Card,{className:"wp-vrt-stat",key:a},(0,e.createElement)(t.CardBody,null,(0,e.createElement)("div",{className:"wp-vrt-stat-value"},String(r)),(0,e.createElement)("div",{className:"wp-vrt-stat-label"},a))))),m=({title:a,description:r,items:l,search:n,onToggleItem:s})=>{const i=l.filter(e=>!n||(e.label+" "+e.url).toLowerCase().includes(n.toLowerCase())).sort((e,t)=>!!e.isDisabled==!!t.isDisabled?0:e.isDisabled?1:-1);return(0,e.createElement)(t.Card,{className:"wp-vrt-section"},(0,e.createElement)(t.CardHeader,null,(0,e.createElement)("div",{className:"wp-vrt-section-header"},(0,e.createElement)("h2",{className:"components-heading"},a),(0,e.createElement)("span",{className:"wp-vrt-pill"},String(i.length))),(0,e.createElement)("p",{className:"wp-vrt-section-desc"},r)),(0,e.createElement)(t.CardBody,null,0===i.length?(0,e.createElement)("p",{className:"wp-vrt-empty"},"No items found."):(0,e.createElement)("div",{className:"wp-vrt-list wp-vrt-list-grid"},i.map(a=>(0,e.createElement)("div",{key:a.url,className:"wp-vrt-row"+(a.isDisabled?" is-disabled":"")},(0,e.createElement)("span",{className:"wp-vrt-row-label"},a.label,a.isDynamic?(0,e.createElement)("span",{className:"wp-vrt-tag"},"Dynamic"):null,a.isDisabled?(0,e.createElement)("span",{className:"wp-vrt-tag wp-vrt-tag-disabled"},"Disabled"):null),(0,e.createElement)(t.Button,{className:"wp-vrt-row-action",href:a.url,target:"_blank",rel:"noopener",icon:"external",label:"Open preview",isSmall:!0,variant:"tertiary"}),a.toggleUrl?(0,e.createElement)("div",{className:"wp-vrt-row-toggle"},(0,e.createElement)(t.ToggleControl,{checked:!a.isDisabled,label:a.isDisabled?"Disabled":"Enabled",onChange:()=>s?.(a)})):null)))))},p=({groups:a,onToggleItem:r})=>a&&0!==a.length?(0,e.createElement)("div",{className:"wp-vrt-groups"},a.map(a=>(0,e.createElement)(t.Card,{className:"wp-vrt-group",key:a.title},(0,e.createElement)(t.CardHeader,null,(0,e.createElement)("div",{className:"wp-vrt-group-header"},(0,e.createElement)("h3",{className:"components-heading"},a.title),(0,e.createElement)("span",{className:"wp-vrt-pill"},String(a.items.length))),a.description?(0,e.createElement)("p",{className:"wp-vrt-section-desc"},a.description):null),(0,e.createElement)(t.CardBody,null,(0,e.createElement)("div",{className:"wp-vrt-list wp-vrt-list-grid"},(a.items||[]).sort((e,t)=>!!e.isDisabled==!!t.isDisabled?0:e.isDisabled?1:-1).map(a=>(0,e.createElement)("div",{key:a.url,className:"wp-vrt-row"+(a.isDisabled?" is-disabled":"")},(0,e.createElement)("span",{className:"wp-vrt-row-label"},a.label,a.isDisabled?(0,e.createElement)("span",{className:"wp-vrt-tag wp-vrt-tag-disabled"},"Disabled"):null),(0,e.createElement)(t.Button,{className:"wp-vrt-row-action",href:a.url,target:"_blank",rel:"noopener",icon:"external",label:"Open preview",isSmall:!0,variant:"tertiary"}),a.toggleUrl?(0,e.createElement)("div",{className:"wp-vrt-row-toggle"},(0,e.createElement)(t.ToggleControl,{checked:!a.isDisabled,label:a.isDisabled?"Disabled":"Enabled",onChange:()=>r?.(a)})):null))))))):null,d=({section:a,onToggleItem:r,onToggleAll:i})=>{const{view:o,updateView:c}=function(t){const{kind:a,name:r,slug:i,defaultView:o,queryParams:c,onChangeQueryParams:m}=t,p=function(e,t,a){return`dataviews-${e}-${t}-${a}`}(a,r,i),d=(0,n.useSelect)(e=>e(s.store).get("core/views",p),[p]),{set:u}=(0,n.useDispatch)(s.store),g=d??o,w=Number(c?.page??g.page??1),v=c?.search??g.search??"";return{view:(0,e.useMemo)(()=>({...g,page:w,search:v}),[g,w,v]),isModified:!!d,updateView:(0,e.useCallback)(e=>{const t={page:e?.page,search:e?.search},a=function(e){const t={...e};for(const e of["page","search"])delete t[e];return t}(e);m&&!l(t,{page:w,search:v})&&m(t),l(g,a)||(l(a,o)?u("core/views",p,void 0):u("core/views",p,a))},[m,w,v,g,o,u,p]),resetToDefault:(0,e.useCallback)(()=>{u("core/views",p,void 0)},[p,u])}}({kind:"wp-vrt",name:"admin",slug:a.title,defaultView:{search:""}});return(0,e.createElement)("div",{className:"wp-vrt-tab-panel"},(0,e.createElement)("div",{className:"wp-vrt-toolbar"},(0,e.createElement)(t.SearchControl,{className:"wp-vrt-search",placeholder:`Search ${a.title.toLowerCase()}â€¦`,value:o.search||"",onChange:e=>c({...o,search:e})}),(0,e.createElement)("div",{className:"wp-vrt-bulk"},a.type?(0,e.createElement)(t.Button,{variant:"secondary",onClick:()=>i?.(a,!0)},"Disable all"):null,a.type?(0,e.createElement)(t.Button,{variant:"secondary",onClick:()=>i?.(a,!1)},"Enable all"):null)),"Blocks"===a.title&&a.groups?(0,e.createElement)("div",{className:"wp-vrt-grid"},(0,e.createElement)(p,{groups:a.groups,onToggleItem:r})):null,(0,e.createElement)("div",{className:"wp-vrt-grid"},(0,e.createElement)(m,{title:a.title,description:a.description,items:a.items||[],search:o.search||"",onToggleItem:r})))},u=document.getElementById("wp-vrt-app");u&&(0,e.render)((0,e.createElement)(()=>{if(!i.baseUrl)return(0,e.createElement)(t.Notice,{status:"warning",isDismissible:!1},"WP VRT data not available.");const a=(i.sections||[]).map(e=>({name:e.title,title:e.title,className:"wp-vrt-tab"})),[r,l]=(0,e.useState)(()=>i.sections||[]),n=async e=>{const t=r.findIndex(t=>t.items?.some(t=>t.url===e.url)),a=r[t]?.type,n=e.toggleUrl?new URL(e.toggleUrl,window.location.href).searchParams.get("id"):null;if(!a||!n)return;const s=!e.isDisabled;await(async({type:e,id:t,disable:a})=>{const r=new FormData;if(r.append("action","wp_vrt_toggle_item"),r.append("_wpnonce",i.toggleNonce||""),r.append("type",e),r.append("id",t),r.append("disable",a?"1":"0"),!(await fetch(i.ajaxUrl||"",{method:"POST",credentials:"same-origin",body:r})).ok)throw new Error("Failed to toggle item")})({type:a,id:n,disable:s});const o=r.map(t=>{const a=(t.items||[]).map(t=>t.url===e.url?{...t,isDisabled:s}:t),r=(t.groups||[]).map(t=>({...t,items:(t.items||[]).map(t=>t.url===e.url?{...t,isDisabled:s}:t)}));return{...t,items:a,groups:r}});l(o)},s=async(e,t)=>{if(!e.type)return;await(async({type:e,disable:t})=>{const a=new FormData;if(a.append("action","wp_vrt_toggle_all"),a.append("_wpnonce",i.toggleAllNonce||""),a.append("type",e),a.append("disable",t?"1":"0"),!(await fetch(i.ajaxUrl||"",{method:"POST",credentials:"same-origin",body:a})).ok)throw new Error("Failed to toggle all")})({type:e.type,disable:t});const a=r.map(a=>{if(a.title!==e.title)return a;const r=(a.items||[]).map(e=>({...e,isDisabled:t})),l=(a.groups||[]).map(e=>({...e,items:(e.items||[]).map(e=>({...e,isDisabled:t}))}));return{...a,items:r,groups:l}});l(a)};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(o),(0,e.createElement)(c),(0,e.createElement)(t.TabPanel,{className:"wp-vrt-tabs",tabs:a},t=>{const a=r.find(e=>e.title===t.name);return a?(0,e.createElement)(d,{section:a,onToggleItem:n,onToggleAll:s}):null}))}),u)})();